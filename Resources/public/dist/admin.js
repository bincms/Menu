var config={title:"Меню",menu:{items:[{title:"Список",url:"extension.menu.list",items:[]}]}};angular.adminModule("menu",["ui.router","bincms.rest","bincms.admin.menu.templates"],config).config(["$stateProvider",function(e){e.state("extension.menu",{url:"/menu"}).state("extension.menu.list",{url:"/list",views:{"content@layout":{templateUrl:"admin/menu/list.html",controller:"MenuListExtensionController"}}}).state("extension.menu.create",{url:"/create",views:{"content@layout":{templateUrl:"admin/menu/create.html",controller:"MenuCreateExtensionController"}}}).state("extension.menu.update",{url:"/update/:id",views:{"content@layout":{templateUrl:"admin/menu/update.html",controller:"MenuUpdateExtensionController",resolve:{menu:["$menuService","$stateParams",function(e,t){return e.get({id:t.id}).$promise}]}}}})}]);var MenuCreateExtensionController=BaseController.extend({init:function(e,t,n){this.menuService=t,this.urlService=n,this._super(e)},getDefaultCategoryModel:function(){return{title:"",url:"",position:0,alias:"",parent:null}},getDefaultSelected:function(){return{parent:null}},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.parent&&angular.isDefined(this.$scope.selected.parent)&&(t.parent=this.$scope.selected.parent.id),this.menuService.save(t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){this.resetForm()},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getParents:function(e){return this.menuService.query({text:e,text_comparison:"endswith",direct:!1}).$promise},resetForm:function(){this.$scope.menuModel=this.getDefaultCategoryModel(),this.$scope.selected=this.getDefaultSelected()},onSelectedUrl:function(e){this.$scope.menuModel.url=e},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.onSelectedUrl=this.onSelectedUrl.bind(this),this.$scope.getParents=this.getParents.bind(this),this.$scope.menuModel=this.getDefaultCategoryModel(),this.$scope.selected=this.getDefaultSelected()},destroy:function(){}});MenuCreateExtensionController.$inject=["$scope","$menuService"],angular.adminModule("menu").controller("MenuCreateExtensionController",MenuCreateExtensionController);var MenuListExtensionController=BaseController.extend({init:function(e,t,n){this.menuService=t,this.locationService=n,this.searchData=n.search(),this._super(e)},onLoadChildClick:function(e){this.loadChild(e)},loadChild:function(e){if(null===e)var t=this.menuService.query(function(){t.length>0&&(this.$scope.breadcrumb=[],this.$scope.menus=t,this.locationService.search("parentId",null))}.bind(this));else var n=this.menuService.get({id:e,is_detailed:!0},function(){n.children.length>0&&(this.$scope.menus=n.children,this.$scope.breadcrumb=n.paths,this.locationService.search("parentId",e))}.bind(this))},onRemoveClick:function(e){this.menuService.delete({id:e.id},this.onRemoveSuccessCallback.bind(this,e))},onRemoveSuccessCallback:function(e){angular.removeItemWithArray(this.$scope.menus,!1,e)},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onLoadChildClick=this.onLoadChildClick.bind(this),this.$scope.onRemoveClick=this.onRemoveClick.bind(this);var e=this.searchData.parentId||null;this.loadChild(e)}});MenuListExtensionController.$inject=["$scope","$menuService","$location"],angular.adminModule("menu").controller("MenuListExtensionController",MenuListExtensionController);var MenuUpdateExtensionController=BaseController.extend({init:function(e,t,n){this.menuService=t,this.menu=n,this._super(e)},getDefaultSelected:function(){return{parent:null}},onSave:function(e,t){e.validate()&&(null!==this.$scope.selected.parent&&angular.isDefined(this.$scope.selected.parent)&&(t.parent=this.$scope.selected.parent.id),this.menuService.update({id:this.menu.id},t,this.saveSuccessCallback.bind(this),this.saveErrorCallback.bind(this,e)))},saveSuccessCallback:function(){},saveErrorCallback:function(e,t){e.setErrors(t.data.errors)},getParents:function(e){return this.menuService.query({text:e,text_comparison:"endswith",direct:!1}).$promise},onSelectedUrl:function(e){this.$scope.menuModel.url=e},defineListeners:function(){this._super()},defineScope:function(){this._super(),this.$scope.onSave=this.onSave.bind(this),this.$scope.onSelectedUrl=this.onSelectedUrl.bind(this),this.$scope.getParents=this.getParents.bind(this),this.$scope.selected=this.getDefaultSelected(),this.$scope.menuModel=this.menu,this.$scope.selected.parent=this.menu.parent},destroy:function(){}});MenuUpdateExtensionController.$inject=["$scope","$menuService","menu"],angular.adminModule("menu").controller("MenuUpdateExtensionController",MenuUpdateExtensionController);